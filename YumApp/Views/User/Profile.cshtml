@*@model List<PostModel>*@
@{    
    ViewData["Title"] = "Profile";

    AppUserModel userProfile = ViewBag.UserProfile;

    var currentLoggedInUserId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier).Value);
}

<div class="d-flex flex-column">
    <div class="user-profile-background bg-success mb-4 mt-3 rounded-circle w-100 d-flex">
        <img src="@userProfile.PhotoPath" alt="User photo" class="user-profile-photo img-fluid img-thumbnail" />
        <div class="user-profile-info ml-5 align-self-center font-weight-light d-flex justify-content-between w-100 align-items-center">
            <div>
                <p class="mb-2 text-white">
                    Name: @userProfile.FirstName @userProfile.LastName
                </p>
                <p class="mb-2 text-white">
                    DOB: @userProfile.DateOfBirth.ToShortDateString()
                </p>
                <p class="mb-2 text-white">
                    Email: @userProfile.Email
                </p>
                <p class="mb-2 text-white">
                    Gender: @userProfile.Gender
                </p>
                @if (!string.IsNullOrWhiteSpace(userProfile.Country))
                {
                    <p class="mb-0 text-white">
                        From: @userProfile.Country
                    </p>
                }
            </div>

            @if (currentLoggedInUserId != userProfile.Id)
            {
                @if (userProfile.IsBeingFollowed)
                {
                    <div class="mr-5 p-5">
                            <button id="followButton" class="btn btn-danger">Unfollow</button>
                    </div>
                }
                else
                {
                    <div class="mr-5 p-5">
                            <button id="followButton" class="btn btn-primary">Follow</button>
                    </div>
                }
            }
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(userProfile.About))
        {
    <div class="user-profile-about pl-5 pr-5 align-self-center font-weight-light">
        <p class="mr-5 text-break">
            About: @userProfile.About
        </p>
    </div>
    }

    <div class="d-flex row mt-3">
        <div class="friends-and-yums col-3">
            <div class="list-group">
                @*<button type="button" class="list-group-item list-group-item-action active">
                        Cras justo odio
                    </button>*@
                <button type="button" class="list-group-item list-group-item-action">
                    <i class="fas fa-user"></i>
                    Following
                </button>
                <button type="button" class="list-group-item list-group-item-action">
                    <i class="fas fa-users"></i>
                    Followers
                </button>
                <button type="button" class="list-group-item list-group-item-action">
                    <i class="fas fa-thumbs-up"></i>
                    Liked posts
                </button>
                MORAS DA NAPRAVIS RAZLICIT PRISTUP PROFILU U ZAVISNOSTI DA LI JE TRENUTNI KORISNIK PRISTUPIO SVOM PROFILU!!!!
            </div>
        </div>

        <div class="verical-line h-auto ml-3 mr-3 bg-secondary">

        </div>

        <div class="userposts col-8">
            <partial name="_UserPostsPartial" />
        </div>
    </div>
</div>
@section Scripts {
    <script>
        @*$(document).ready(function () {
            $('#followButton').click(function () {
                if (@userProfile.IsBeingFollowed) {
                    $.post('/User/UnfollowUser/@userProfile.Id.ToString()',
                        function () {
                            $('#followButton').removeClass('btn-danger').addClass('btn-primary').text('Follow');
                        }
                )} else {
                    $.post('/User/FollowUser/@userProfile.Id.ToString()',
                        function () {
                                $('#followButton').removeClass('btn-primary').addClass('btn-danger').text('Unfollow');
                    });
                }
            });
        });*@

        @*$(document).ready(function () {
            $('.followButton').click(function () {
                $.ajax({
                    type: 'POST',
                    url: '/User/FollowUser/@userProfile.Id.ToString()',
                    success: function () {
                        $('.followButton').removeClass('followButton btn-primary').addClass('unfollowButton btn-danger').text('Unfollow');
                        alert("DOSLO JE DO OVDE");

                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                })
            });

            $('.unfollowButton').click(function () {
                $.ajax({
                    type : 'POST',
                    url : '/User/UnfollowUser/@userProfile.Id.ToString()',
                    success: function () {
                        $('.unfollowButton').removeClass('unfollowButton btn-danger').addClass('followButton btn-primary').text('Follow');
                        alert("DOSLO JE DO OVDE");
                        //$('#unfollowButton').hide();
                        //$('#followButton').show();
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                })
            })
        });*@

        var doesFollow = '@userProfile.IsBeingFollowed.ToString()'.toLowerCase();

            $(document).ready(function () {
            $('#followButton').click(function () {
                if (!doesFollow) {
                    $.ajax({
                    type : 'POST',
                    url : '/User/UnfollowUser/@userProfile.Id.ToString()',
                    success: function () {
                        $('#followButton').removeClass('btn-danger').addClass('btn-primary').text('Follow');
                        doesFollow = !doesFollow;
                        alert("user unfollowed!");
                    },
                    error: function (response) {
                        alert(response.responseText);
                        }                    
                })
                } else {
                    $.ajax({
                        type: 'POST',
                        url: '/User/FollowUser/@userProfile.Id.ToString()',
                        success: function () {
                            $('#followButton').removeClass('btn-primary').addClass('btn-danger').text('Unfollow');
                            doesFollow = !doesFollow;
                            alert("user followed!");
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    })
                }
            });
        });


        //var btn = document.getElementById('followButton');
        //var follows = btn.dataset.follows;
        //btn.addEventListener('click', FollowUnfollow);

        //function FollowUnfollow() {
        //    if (follows == 'true') {

        //    }
        //}


    </script>
}
